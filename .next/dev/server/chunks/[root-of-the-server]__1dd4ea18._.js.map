{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///home/abdul-hafiz/Desktop/python/sharporder/src/app/api/products/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport fs from 'fs/promises';\nimport path from 'path';\n\nconst DB_PATH = path.join(process.cwd(), 'data', 'products.json');\n\nasync function readDB() {\n  try {\n    const raw = await fs.readFile(DB_PATH, 'utf8');\n    return JSON.parse(raw);\n  } catch (e) {\n    return { products: [] };\n  }\n}\n\nasync function writeDB(obj: any) {\n  await fs.mkdir(path.dirname(DB_PATH), { recursive: true });\n  await fs.writeFile(DB_PATH, JSON.stringify(obj, null, 2), 'utf8');\n}\n\nexport async function GET(req: Request) {\n  const db = await readDB();\n  const url = new URL(req.url);\n  const storeId = url.searchParams.get('storeId');\n  const category = url.searchParams.get('category');\n  const pageParam = parseInt(url.searchParams.get('page') || '1', 10);\n  const limitParam = parseInt(url.searchParams.get('limit') || '12', 10);\n  const sort = url.searchParams.get('sort');\n  const search = url.searchParams.get('search');\n\n  const page = Number.isFinite(pageParam) && pageParam > 0 ? pageParam : 1;\n  const limit = Number.isFinite(limitParam) && limitParam > 0 ? limitParam : 12;\n\n  let list = Array.isArray(db.products) ? db.products.slice() : [];\n\n  if (storeId) {\n    list = list.filter((p: any) => p.storeId === storeId);\n  }\n\n  if (category) {\n    const catLower = category.toLowerCase();\n    list = list.filter((p: any) => (p.category || '').toLowerCase() === catLower);\n  }\n\n  // server-side search filtering\n  if (search) {\n    const searchLower = search.toLowerCase();\n    list = list.filter((p: any) => {\n      const name = (p.name || '').toLowerCase();\n      const desc = (p.description || '').toLowerCase();\n      return name.includes(searchLower) || desc.includes(searchLower);\n    });\n  }\n\n  // server-side sorting\n  if (sort) {\n    switch (sort) {\n      case 'price_asc':\n        list.sort((a: any, b: any) => (Number(a.price) || 0) - (Number(b.price) || 0));\n        break;\n      case 'price_desc':\n        list.sort((a: any, b: any) => (Number(b.price) || 0) - (Number(a.price) || 0));\n        break;\n      case 'name_asc':\n        list.sort((a: any, b: any) => String((a.name || '')).localeCompare(String(b.name || '')));\n        break;\n      case 'name_desc':\n        list.sort((a: any, b: any) => String((b.name || '')).localeCompare(String(a.name || '')));\n        break;\n      case 'newest':\n        list.sort((a: any, b: any) => {\n          const ta = a.createdAt ? new Date(a.createdAt).getTime() : (typeof a.id === 'string' && a.id.startsWith('prod_') ? parseInt(a.id.replace(/^prod_/, ''), 10) : 0);\n          const tb = b.createdAt ? new Date(b.createdAt).getTime() : (typeof b.id === 'string' && b.id.startsWith('prod_') ? parseInt(b.id.replace(/^prod_/, ''), 10) : 0);\n          return tb - ta;\n        });\n        break;\n      default:\n        break;\n    }\n  }\n\n  const total = list.length;\n  const totalPages = Math.max(1, Math.ceil(total / limit));\n  const start = (page - 1) * limit;\n  const paged = list.slice(start, start + limit);\n\n  return NextResponse.json({ products: paged, total, page, limit, totalPages });\n}\n\nexport async function POST(req: Request) {\n  try {\n    const body = await req.json();\n    const product = body.product;\n    if (!product || typeof product !== 'object' || !product.storeId) {\n      return NextResponse.json({ error: 'Invalid product or missing storeId' }, { status: 400 });\n    }\n\n    const db = await readDB();\n    const id = product.id || `prod_${Date.now()}`;\n    const newProduct = { ...product, id };\n    db.products = db.products || [];\n    db.products.push(newProduct);\n    await writeDB(db);\n\n    return NextResponse.json(newProduct);\n  } catch (err: any) {\n    return NextResponse.json({ error: err.message || 'Failed' }, { status: 500 });\n  }\n}\n\nexport async function PUT(req: Request) {\n  try {\n    const body = await req.json();\n    const product = body.product;\n    if (!product || typeof product !== 'object' || !product.id || !product.storeId) {\n      return NextResponse.json({ error: 'Invalid product or missing id/storeId' }, { status: 400 });\n    }\n\n    const db = await readDB();\n    db.products = db.products || [];\n    const idx = db.products.findIndex((p: any) => p.id === product.id && p.storeId === product.storeId);\n    if (idx === -1) {\n      return NextResponse.json({ error: 'Product not found' }, { status: 404 });\n    }\n\n    db.products[idx] = { ...db.products[idx], ...product };\n    await writeDB(db);\n\n    return NextResponse.json(db.products[idx]);\n  } catch (err: any) {\n    return NextResponse.json({ error: err.message || 'Failed' }, { status: 500 });\n  }\n}\n\nexport async function DELETE(req: Request) {\n  try {\n    // allow id in query or body\n    const url = new URL(req.url);\n    const idFromQuery = url.searchParams.get('id');\n    let id = idFromQuery;\n    const storeId = url.searchParams.get('storeId');\n    if (!id) {\n      try {\n        const body = await req.json();\n        id = body?.id;\n      } catch (e) {\n        // ignore\n      }\n    }\n\n    if (!id) {\n      return NextResponse.json({ error: 'Missing id' }, { status: 400 });\n    }\n\n    const db = await readDB();\n    db.products = db.products || [];\n    const idx = db.products.findIndex((p: any) => p.id === id && (!storeId || p.storeId === storeId));\n    if (idx === -1) {\n      return NextResponse.json({ error: 'Product not found' }, { status: 404 });\n    }\n\n    const removed = db.products.splice(idx, 1)[0];\n    await writeDB(db);\n\n    return NextResponse.json({ success: true, removed });\n  } catch (err: any) {\n    return NextResponse.json({ error: err.message || 'Failed' }, { status: 500 });\n  }\n}\n"],"names":[],"mappings":"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"}}]
}